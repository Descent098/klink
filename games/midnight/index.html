<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=0.9"><link rel="icon" type="image/svg+xml" href="https://klnk.ca/favicon.svg"><meta name="generator" content="Astro v5.7.3"><title>Klnk</title><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.O60KwBJx.js"></script><style>button{transition:opacity 1s ease-out}.buttonGroup{display:flex;gap:1rem}.drinks{font-family:cursive,sans-serif}#gameContent{display:none;opacity:0;padding-top:15vh;transition:opacity 2s ease-in-out}#setupGame{position:absolute;inset:0;z-index:1;display:flex;justify-content:center;align-items:center;gap:10px;flex-direction:column}#mainLogoContainer{padding:.5rem;transition:all .6s ease;position:absolute;top:30vh}#responsibleWarning{margin:10vh auto;padding:1.2rem;line-height:1.8;text-align:center;width:120ch;border-radius:1.1rem;background:#f0f0f0}#instructions,#settings,#endGameOutcome{margin:10vh auto;padding:1.2rem;line-height:1.8;text-align:center;width:120ch;height:90vh;border-radius:1.1rem;background:#f0f0f0}#instructions h2,#instructions h3{padding-top:1.1rem}#instructions .close,#settings .close,#responsibleWarning .close,#endGameOutcome .close{margin-bottom:2rem;padding:.5rem;cursor:pointer}#settings fieldset{border:none;padding:.3rem}#settings select{border-radius:1.1rem;font-family:cursive;font-weight:400}#endGameNotice{position:absolute;text-align:center;z-index:100;display:none;inset:20% 0 0 15%;align-items:center;width:70vw;padding:1rem;border-radius:1.1rem;height:60vh}#endGameOutcome{height:40vh;font-size:1.3rem}@media (max-width:500px){#mainLogoContainer{top:15vh}}
footer[data-astro-cid-sz7xmlte]{width:80%;margin:.8rem auto;display:grid;grid-template-columns:1fr 6fr 1fr;grid-template-rows:repeat(2,1fr);grid-column-gap:5px;grid-row-gap:15px;justify-content:center;align-items:center;padding:2rem;font-family:Indie Flower,cursive;font-weight:bolder}footer[data-astro-cid-sz7xmlte] [data-astro-cid-sz7xmlte]{text-align:center}nav{word-wrap:break-word!important;position:sticky;inset:0;height:7vh;width:100%;background-color:var(--background-color);display:grid;grid-template-columns:2fr 6fr repeat(2,1fr);grid-template-rows:1fr;grid-column-gap:5px;grid-row-gap:0px;filter:drop-shadow(5px 5px 10px #0000001d);border-bottom-left-radius:.8rem;font-weight:bolder;border-bottom-right-radius:.8rem;padding:.2rem;align-items:center;z-index:150;font-family:Indie Flower,cursive}nav a,nav .dropdown{text-decoration:none;padding:.5rem;font-size:1.3rem;justify-content:center;text-align:center}nav ul{margin-top:1.1rem;list-style:none;position:relative}nav ul li{display:inline-block}@media (min-width: 1200px){nav .dropdown:after{content:" +"}}nav .dropdown ul{display:none;position:absolute;top:4vh}nav .dropdown:hover>ul{display:inherit}nav .dropdown li{width:100px;float:none;display:list-item;position:relative;background:var(--background-cell-color);border-radius:.5rem;padding:.3rem;margin-left:.3rem}#navLogo{width:10%;height:6vh}#navLogo img{width:50px;height:50px;padding:.4rem}.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@font-face{font-family:Indie Flower;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/indie-flower-1.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Indie Flower;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/indie-flower-2.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}*{box-sizing:border-box;margin:0;padding:0}:root{--background-color:#f0f0f0;--background-cell-color:#cacaca;--font-size: 1.5rem;--grid-size: 100px}html,body{width:100%;min-height:100vh}main{padding-top:1.3rem;display:flex;justify-content:center;align-items:center;min-height:100vh;flex-direction:column;width:100%}body{font-family:Indie Flower,cursive;font-weight:bolder;background-color:var(--background-color)}button,.btn{padding:1.1rem;border-radius:.8rem;background:#141414;color:#f0f0f0;font-family:Indie Flower,cursive;font-weight:bolder;text-transform:capitalize;font-size:var(--font-size);cursor:pointer;text-decoration:none}button.disabled{background:#505050;color:#f0f0f0;cursor:not-allowed}.secondary-btn{background:transparent!important;color:#000!important}details{padding:1.1rem;border-radius:.8rem;background:var(--background-cell-color);color:#000;font-family:Indie Flower,cursive;font-weight:bolder;text-transform:capitalize;font-size:var(--font-size);cursor:pointer;width:100%;margin-bottom:1.2rem}details[open] ul{padding-left:1.4rem;margin-left:1.4rem}@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
</style><script type="module" src="/_astro/page.CPvyyiTs.js"></script><style>[data-astro-transition-scope="astro-46uktw2d-1"] { view-transition-name: inlineLogo; }@layer astro { ::view-transition-old(inlineLogo) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }::view-transition-new(inlineLogo) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back]::view-transition-old(inlineLogo) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back]::view-transition-new(inlineLogo) { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-46uktw2d-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-46uktw2d-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-46uktw2d-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-46uktw2d-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-46uktw2d-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-46uktw2d-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeOut; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-46uktw2d-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-46uktw2d-1"] { 
	animation-duration: 180ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both;
	animation-name: astroFadeIn; }</style></head> <body> <nav> <a id="navLogo" href="/"><img src="/icon.png" alt=""></a> <div></div> <!-- <div class="dropdown">
        <a href="/games">Games</a>
        <ul>
            <li><a href="/games/bingo">Bingo</a></li>
            <li><a href="/games/blackjack">Blackjack</a></li>
        </ul>  
    </div> --> <a href="/games">Games</a> <a href="/about">About</a> </nav>  <main>  <div id="endGameNotice"> <dialog id="endGameOutcome"> <h2 style="text-decoration: underline;font-size-adjust: 110%;">You win</h2> <br> <button class="close" onclick="document.getElementById('endGameOutcome').close();body.style.overflow='auto';startGame()">Restart Game</button> </dialog> </div> <h1 id="mainLogoContainer"><span id="inlineLogo" data-astro-transition-scope="astro-46uktw2d-1"><img src="/icon.png" alt="" srcset="" width="50px"> Klnk</span> Midnight</h1> <div id="gameContent">  <div id="opDice"></div> <div id="currentDice"></div> <div id="outcome"></div> <div id="totalBet"></div> <div id="bet">
Your current bet is: <button onclick="currentGame.updateBet(-1)">-1</button> <span id="drinkBet" class="drinks">1</span> <button onclick="currentGame.updateBet(1)">+1</button> drink(s)
</div> <div id="controls"> <button onclick="currentGame.roll()">Roll Dice</button> </div>   <script src="/js/dice.js"></script> <script>
        /**@type {Midnight?} */
        let currentGame = null

        class Midnight{
            constructor(){
                this.totalBet = 0
                this.currentBet = 1
                /**@type {Dice[]} */
                this.keptDice = []
                /**@type {Dice[]} */
                this.currentRoll = []
                /**@type {Dice[]} */
                this.diceToKeep = []
            }

            roll(){
                if ((this.currentRoll.length > 0) && !(this.diceToKeep.length > 0)){
                    // Must keep at least 1 dice
                    // TODO: Display to user
                    console.log("Can't reroll")
                    return
                }
                // Update state
                this.keptDice = [...this.keptDice, ...this.diceToKeep]
                this.keptDice = Dice.sortDiceArray(this.keptDice)
                this.totalBet += this.currentBet

                if (this.keptDice.length === 6){
                    this.finished()
                    return
                }
                // Reset state
                this.diceToKeep = []
                this.currentRoll = [] 
                this.currentBet = 1
                // Reset UI
                //@ts-ignore
                document.getElementById("drinkBet").innerHTML = 1
                //@ts-ignore
                document.getElementById("currentDice").innerHTML = ""
                //@ts-ignore
                document.getElementById("totalBet").innerHTML = `Your total bets so far: <span class="drinks">${this.totalBet}</span>`

                // Generate new dice
                let diceToRoll = 6 - this.keptDice.length

                for (let i=0; i < diceToRoll; i++){
                    const newDice = Dice.getRandomDice()
                    this.currentRoll.push(newDice)
                    //@ts-ignore
                    document.getElementById("currentDice").innerHTML += `
                    <div class="die">
                        ${newDice.html}
                        <button onclick="currentGame.keepDice(${i}, this)">Keep</button>
                    </div>`
                }
                this.currentRoll = [...this.currentRoll, ...this.keptDice]

                for (const die of this.keptDice){
                    //@ts-ignore
                    document.getElementById("currentDice").innerHTML += `
                    <div class="die">
                        ${die.html}
                        <button class="disabled">Kept</button>
                    </div>`
                }

            }

            /**
             * Keeps the specified dice
             * @param index {Number} The index of the dice to keep
             * @param button {HTMLElement} The button clicked
             */
            keepDice(index, button){
                const die = this.currentRoll[index]
                this.diceToKeep.push(die)
                button.innerHTML = "Unkeep"
                button.onclick = () => this.unKeepDice(index, button, die);
            }

            /**
             * Unkeeps the specified dice
             * @param index {Number} The currentRoll index of the dice to unkeep
             * @param button {HTMLElement} The button clicked
             * @param die {Dice} The dice to unkeep
             */
             unKeepDice(index, button, die){
                // TODO
                this.diceToKeep.indexOf(die)
                

                button.innerHTML = "Keep"
                button.onclick = () => this.keepDice(index, button);
            }

            /**
             * A function to update the bet and display the results
             * @param amount {Number} The amount to increase/decrease the bet by
             */
            updateBet(amount){
                if ((amount < 1 && this.currentBet > 1)||(amount > 0 && this.currentBet < 10)){
                    this.currentBet +=amount
                } 
                // Update bet indicator
                //@ts-ignore
                document.getElementById('drinkBet').innerHTML = this.currentBet;
            }

            /**
             * Calculates the value of the roll
             * @param roll {Dice[]}
             * @returns {Number} The value of the roll
             */
            calculateRollValue(roll){
                roll = Dice.sortDiceArray(roll)

                let hasOne = false
                let hasFour = false
                let result = 0
                for (const die of roll){
                    if (die.number === 1 && !hasOne){
                        hasOne = true
                    } else if (die.number === 4 && !hasFour){
                        hasFour = true
                    } else{
                        result += die.number
                    }
                }

                if (hasFour && hasOne){
                    return result
                } else{
                    return 0
                }

            }

            /**
             * Generate an opponent move
             * @returns {Dice[]} The opponent move
             */
            runOpponent(){
                /**@type {Dice[]} */
                let opponentKeptDice = []
                let opponentHasOne = false
                let opponentHasFour = false

                while (opponentKeptDice.length < 6){
                    let keptADie = false
                    let diceToGenerate = 6 - opponentKeptDice.length
                    /**@type {Dice[]} */
                    let generatedDice = []
                    for (let i=0; i<diceToGenerate; i++){
                        const newDie = Dice.getRandomDice()
                        generatedDice.push(newDie)
                        if (newDie.number == 1 && !opponentHasOne){
                            opponentHasOne = true
                            keptADie = true
                            opponentKeptDice.push(newDie)                            
                        } else if (newDie.number == 4 && !opponentHasFour){
                            opponentHasFour = true
                            keptADie = true
                            opponentKeptDice.push(newDie)
                        } else if (newDie.number == 5 || newDie.number == 6){
                            keptADie = true
                            opponentKeptDice.push(newDie)
                        }
                    }
                    if (!keptADie){
                        // Keep largest Die
                        generatedDice = Dice.sortDiceArray(generatedDice)
                        opponentKeptDice.push(generatedDice[generatedDice.length-1])
                    }
                }
                return opponentKeptDice
            }

            finished(){
                console.log("finished")
                let playerTotal = this.calculateRollValue(this.currentRoll)
                //@ts-ignore
                document.getElementById("currentDice").innerHTML = `<p>You:</p>
                    <div class="die">
                        ${this.currentRoll[0].html}
                    </div>
                    <div class="die">
                        ${this.currentRoll[1].html}
                    </div>
                    <div class="die">
                        ${this.currentRoll[2].html}
                    </div>
                    <div class="die">
                        ${this.currentRoll[3].html}
                    </div>
                    <div class="die">
                        ${this.currentRoll[4].html}
                    </div>
                    <div class="die">
                        ${this.currentRoll[5].html}
                    </div>
                    <div>
                        Total = <span class="drinks">${playerTotal}</span>
                    </div>
                `
                //@ts-ignore
                document.getElementById("controls").innerHTML = `<button onclick="startGame()">New Game</button>`

                // Determine opponent score and compare
                let opponent = this.runOpponent()
                let opponentScore = this.calculateRollValue(opponent)

                //@ts-ignore
                document.getElementById("opDice").innerHTML = `<p>Opponent:</p>
                    <div class="die">
                        ${opponent[0].html}
                    </div>
                    <div class="die">
                        ${opponent[1].html}
                    </div>
                    <div class="die">
                        ${opponent[2].html}
                    </div>
                    <div class="die">
                        ${opponent[3].html}
                    </div>
                    <div class="die">
                        ${opponent[4].html}
                    </div>
                    <div class="die">
                        ${opponent[5].html}
                    </div>
                    <div>
                        Total = <span class="drinks">${opponentScore}</span>
                    </div>
                `

                // Determine who won
                if (playerTotal > opponentScore){
                    //@ts-ignore
                    document.getElementById("totalBet").innerHTML = `Give out <span class="drinks">${this.totalBet} drink(s)</span>`
                } else {
                    //@ts-ignore
                    document.getElementById("totalBet").innerHTML = `Take <span class="drinks">${this.totalBet} drink(s)</span>`
                }

                //@ts-ignore
                document.getElementById("bet").innerHTML = ""
            }
        }
    
    
    /**
     * Clears the start screen and shows the game content
     */
    function clearStartScreen(){
        //@ts-ignore
        document.getElementById("setupGame").style.display = "none";
        //@ts-ignore
        document.getElementById("gameContent").style.display = "block";
        //@ts-ignore
        document.getElementById("gameContent").style.opacity = "1";
        //@ts-ignore
        document.getElementById("mainLogoContainer").style.top = "15vh"; 
    }

    function startGame(){
        currentGame = new Midnight()

        // Startup new game
        clearStartScreen()
        
        // Reset any old game displays
        //@ts-ignore
        document.getElementById("totalBet").innerHTML = ""
        //@ts-ignore
        document.getElementById("opDice").innerHTML = ""
        //@ts-ignore
        document.getElementById("currentDice").innerHTML = ""
        //@ts-ignore
        document.getElementById("outcome").innerHTML = ""
        
        // Setup initial game UI
        //@ts-ignore
        document.getElementById("bet").innerHTML = `Your current bet is: <button id="subtractFromBet" style="display:inline;font-size:1rem;font-family:cursive; padding:.3rem;" onclick="if (currentGame.currentBet > 1){currentGame.currentBet -=1}; document.getElementById('drinkBet').innerHTML = currentGame.currentBet; ">-1</button> <span id="drinkBet" class="drinks">1</span> <button id="addToBet" style="display:inline;font-size:1rem;font-family:cursive; padding:.3rem;" onclick="if (currentGame.currentBet < 10){currentGame.currentBet +=1}; document.getElementById('drinkBet').innerHTML = currentGame.currentBet;">+1</button> drink(s)`
        //@ts-ignore
        document.getElementById("controls").innerHTML = `<button onclick="currentGame.roll()">Roll Dice</button>`
        currentGame.currentBet = 0
        currentGame.roll()
        
    }
    </script> <style>
            .dice{
                font-size:4rem;
                font-family: sans-serif;
                font-weight:400;
            }
            #bet button{
                display:inline;
                font-size:1rem;
                font-family:cursive; 
                padding:.3rem;
            }
            #currentDice,
            #opDice{
                display:flex;
                align-items:center;
            }
            .die{
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            .die button{
                font-size:.75rem;
                font-family:cursive; 
                padding:.6rem;
            }
        </style>  </div> <div id="setupGame"> <button id="startGame" onclick="document.getElementById('responsibleWarning').showModal()" style="cursor:pointer;">Start game</button> <div class="buttonGroup"> <button class="secondary-btn" onclick="document.getElementById('instructions').showModal();body.style.overflow='hidden';">Instructions</button> <button class="secondary-btn" onclick="document.getElementById('settings').showModal();body.style.overflow='hidden';">Settings</button> </div> <dialog id="responsibleWarning"> <h2 style="text-decoration: underline;font-size-adjust: 110%;">Warning</h2> <strong>Please note that we take no accountability for what you choose to use this game for. </strong> <br> <strong>Please drink responsibly, and never drive after drinking!</strong> <br> <button class="close" onclick="document.getElementById('responsibleWarning').close();body.style.overflow='auto';startGame()">I understand</button> </dialog> <dialog id="instructions"> <h2 style="text-decoration: underline;font-size-adjust: 110%;">Instructions</h2> <div> <h2>Welcome to Midnight</h2> <p>Midnight is a game of chance with a dash of quick-thinking, and strategizing</p> <h3>Basic Rules</h3> <p>Each roll you are given the option to keep dice. You MUST keep at least 1 die per roll. Game ends when you have kept 6 dice.</p> <h3>Winning</h3> <p>In order to score you must have kept a 1 and a 4. If you don't have both, you get a 0 score. You win if your score is better than your opponents (ties go to the opponent)</p> </div> <button class="close" onclick="document.getElementById('instructions').close();body.style.overflow='auto';">Close</button> </dialog> <dialog id="settings"> <h2 style="text-decoration: underline;font-size-adjust: 110%;">Settings</h2> <div></div> <button class="close" onclick="document.getElementById('settings').close();body.style.overflow='auto';">Close</button> </dialog> </div>  </main> <hr style="margin: .5rem auto;width:80%;"> <footer data-astro-cid-sz7xmlte> <ul data-astro-cid-sz7xmlte> <a href="https://github.com/descent098/klnk" data-astro-cid-sz7xmlte>Source</a> </ul> <div data-astro-cid-sz7xmlte>Please Drink Responsibly</div> <ul data-astro-cid-sz7xmlte> <a href="/tos" data-astro-cid-sz7xmlte>Terms of Service</a> </ul> <div class="spacer" data-astro-cid-sz7xmlte></div> <ul data-astro-cid-sz7xmlte> <a href="/about" data-astro-cid-sz7xmlte>About</a> </ul> <div class="spacer" data-astro-cid-sz7xmlte></div> </footer>  </body></html> 